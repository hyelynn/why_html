<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ART BY US</title>

    <!-- Bootstrap 4.3.1 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

    <!-- Custom -->
    <link rel="stylesheet" href="/css/custom.css">
    <link rel="stylesheet" href="/css/custom_host.css">
    <link rel="stylesheet" href="/css/datepicker.css">

    <!-- Fontawesome -->
    <link rel="stylesheet" href="/css/fontawesome/css/all.min.css"><script src="/js/include.js"></script>
    <!-- Custom -->

    <script type="text/javascript" src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.0.js"
        charset="utf-8"></script>
    <script src="/js/kakao_sdk.js"></script>

    <script>
        Kakao.init('d88bea310f4a39afbea3146fe1c0fa72');
        Kakao.isInitialized();
    </script>

    <script src="js/custom.js"></script>

    <!-- Fontawesome -->
    <link rel="stylesheet" href="css/fontawesome/css/all.min.css">
</head>

<body>
    <modal include-html="/include/header.html"></modal>
    <div class="py-md-3 px-5 py-2 text-center text-white bg-deep-dark top-notice">
        <span class="font-weight-light">코로나19에 대한 아트바이어스의 대책 및 환불 정책에 대한 최신 정보를 확인하세요.</span>
        <a href="#x" class="text-white d-lg-inline-block d-block">자세히 알아보기</a>
    </div>

    <!-- 헤더부분 네비게이션 바-->
    <nav class="navbar navbar-expand-lg navbar-light py-lg-3 py-1">
        <div class="container">
            <!--네비게이션 바 버튼-->
            <a class="navbar-brand" href="/host/index.html"><img src="http://artbyus.co.kr/img/us-partner-logo.png"
                srcset="http://artbyus.co.kr/img/us-partner-logo@2x.png 2x, http://artbyus.co.kr/img/us-partner-logo@3x.png 3x"></a>
            
            <button class="navbar-toggler border-0 font-size-md text-dark" type="button" data-toggle="collapse"
                data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false"
                aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>

            <div class="collapse navbar-collapse" id="navbarNavDropdown"></div>
        </div>
    </nav>
    <script src="/js/header.js"></script>


    <main role="main">
        <div class="container overflow-hidden my-md-5 my-4 px-md-0">
            <!-- 등록 프로세스 : min-width 992에서 글자 줄바꿈 현상 때문에, 해당 프로세스 글자만 출력 -->
            <div class="mb-md-5 mb-4 font-weight-light host-regist-proc">
                <div class="row">
                    <div class="col-lg-3 col-12 d-lg-block d-none">
                        <p class="mb-0 pb-2 step active">01. 카테고리 선택</p>
                    </div>
                    <div class="col-lg-3 col-12 d-lg-block d-none">
                        <p class="mb-0 pb-2 step active">02. 소개 입력</p>
                    </div>
                    <div class="col-lg-3 col-12 d-lg-block d-none">
                        <p class="mb-0 pb-2 step active">03. 세부 정보 입력</p>
                    </div>
                    <div class="col-lg-3 col-12">
                        <p class="mb-0 pb-2 step active">04. 요금 체계 및 시간 설정</p>
                    </div>
                </div>
            </div>

            <!-- 클래스 요금 체계 및 시간 -->
            <h3 class="mb-md-4 mb-3">클래스 유형과 일정, 금액을 입력해 주세요</h3>
            <div class="custom-inputs-sub host-register-form">
            <!-- 타입1 -->
                <!-- 유형 -->
                <div class="custom-inputs custom-inputs-sub mb-lg-5 mb-3">
                    <div class="text-gray font-weight-light">
                        <label>예약 유형</label>
                    </div>
                    <div class="d-md-flex mb-3">
                        <div class="flex-fill host-register-items mb-md-0 mb-3">
                            <label class="radio-items">
                                <input type="radio" name="category1" value="1" checked="checked">
                                <span>일반 클래스</span>
                            </label>
                        </div>
                        <div class="flex-fill host-register-items">
                            <label class="radio-items">
                                <input type="radio" name="category1" value="2">
                                <span>공동 구매식 클래스</span>
                            </label>
                        </div>
                    </div>
                    <!-- 안내사항 -->
                    <p class="mb-1">* 일반 클래스는 강사가 수업을 취소할 수 없습니다.</p>
                    <p class="mb-1">* 공동 구매식 클래스는 인원이 차지 않으면 수업을 진행할 수 없습니다.</p>
                </div>

                <!-- 레슨 일정 선택 : 캘린더에 등록된 레슨 선택 -->
                <div class="custom-inputs custom-inputs-sub mb-lg-5 mb-3 tag2">
                    <div class="text-gray font-weight-light">
                        <label>레슨 일정 (최대 20개)</label>
                    </div>
                    <div class="d-md-flex">
                        <div class="d-flex justify-content-end align-items-center form-control">
                            <input id="lesson_start" type="text" class="bg-transparent border-0 w-100 h-100 text-gray datePickerDrop">
                        </div>

                        <div class="d-flex justify-content-end align-items-center form-control mr-md-3 mb-md-0 mb-3">
                            <input type="text" id="lesson_price" class="bg-transparent border-0 w-100 h-100 text-right text-gray tag-text">
                            <span class="ml-3 text-light-gray">원</span>
                        </div>

                        <button type="button" class="btn bg-yellow fnc-btn" onclick="addTime2()">추가하기</button>
                    </div>

                    <!-- 태그 -->
                    <div id="clock" class="d-flex justify-content-between align-content-center flex-wrap host-search-tags full">
                        
                    </div>
                </div>

                <!-- 기준인원 -->
                <div class="row custom-inputs custom-inputs-sub mb-lg-5 mb-3">
                    <div class="col-md-6">
                        <div class="text-gray font-weight-light">
                            <label>기준인원</label>
                        </div>
                        <div class="d-flex justify-content-between">
                            <button type="button" id="decreaseQuantity" class="btn border bg-gray number-btn">-</button>
                            <input type="text" id="numberUpDown" value="1" class="text-center form-control border-right-0 border-left-0" style="width: calc(100% - 100px);">
                            <button type="button" id="increaseQuantity" class="btn border bg-yellow number-btn">+</button>
                        </div>
                    </div>
                </div>

            <!-- 타입2 -->
                <!-- 유형 -->
                <div class="custom-inputs custom-inputs-sub mb-lg-5 mb-3">
                    <div class="text-gray font-weight-light">
                        <label>예약 유형</label>
                    </div>
                    <div class="d-md-flex mb-3">
                        <div class="flex-fill host-register-items mb-md-0 mb-3">
                            <label class="radio-items">
                                <input type="radio" name="category2" value="1" checked="checked">
                                <span>일반 클래스</span>
                            </label>
                        </div>
                        <div class="flex-fill host-register-items">
                            <label class="radio-items">
                                <input type="radio" name="category2" value="2">
                                <span>쉐어 클래스</span>
                            </label>
                        </div>
                    </div>
                    <!-- 안내사항 -->
                    <p class="mb-1">* 일반 클래스는 강사가 수업을 취소할 수 없습니다.</p>
                    <p class="mb-1">* 쉐어 클래스는 인원이 차지 않으면 수업을 진행할 수 없습니다.</p>
                </div>

                <!-- 레슨 일정 선택 : 캘린더에 등록된 레슨 선택 -->
                <div class="custom-inputs custom-inputs-sub mb-lg-5 mb-3 tag1">
                    <div class="text-gray font-weight-light">
                        <label>레슨 일정 (최대 20개)</label>
                    </div>
                    <div class="d-md-flex">
                        <div class="d-flex justify-content-end align-items-center form-control">
                            <input id="lesson_start2" type="text" class="bg-transparent border-0 w-100 h-100 text-gray datePickerDrop">
                        </div>

                        <div class="d-flex justify-content-end align-items-center form-control mr-md-3 mb-md-0 mb-3">
                            <input type="text" id="lesson_price2" class="bg-transparent border-0 w-100 h-100 text-right text-gray tag-text">
                            <span class="ml-3 text-light-gray">원</span>
                        </div>

                        <button type="button" class="btn bg-yellow fnc-btn" onclick="addTime3()">추가하기</button>
                    </div>

                    <!-- 태그 -->
                    <div id="clock2" class="d-flex justify-content-between align-content-center flex-wrap host-search-tags full">
                        
                    </div>
                </div>

                <!-- 기준인원 -->
                <div class="row custom-inputs custom-inputs-sub mb-lg-5 mb-3">
                    <div class="col-md-6">
                        <div class="text-gray font-weight-light">
                            <label>기준인원</label>
                        </div>
                        <div class="d-flex justify-content-between">
                            <button type="button" id="decreaseQuantity2" class="btn border bg-gray number-btn">-</button>
                            <input type="text" id="numberUpDown2" value="1" class="text-center form-control border-right-0 border-left-0" style="width: calc(100% - 100px);">
                            <button type="button" id="increaseQuantity2" class="btn border bg-yellow number-btn">+</button>
                        </div>
                    </div>
                </div>

                <!-- 공통 환불규정 -->
                <div class="mb-lg-5 mb-3">
                    <div class="text-gray font-weight-light">
                        <label>아트바이어스의 공통 환불 규정입니다</label>
                    </div>
                    <div class="host-register-items">
                        <table class="table table-bordered text-center color-table">
                            <thead>
                                <tr>
                                    <th>환불 요청 날짜</th>
                                    <th>환불 가능 금액</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>D-5</td>
                                    <td>100% 환불</td>
                                </tr>
                                <tr>
                                    <td>D-3</td>
                                    <td>70% 환불</td>
                                </tr>
                                <tr>
                                    <td>D-2</td>
                                    <td>50% 환불</td>
                                </tr>
                                <tr>
                                    <td>D-1</td>
                                    <td>환불 불가</td>
                                </tr>
                                <tr>
                                    <td>D-day</td>
                                    <td>환불 불가</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 이전단계 / 다음단계 -->
        <div class="overflow-hidden mt-lg-5 mt-3">
            <a href="class_register3.html" class="btn bg-gray float-left w-50 rounded-0 py-lg-4 py-3 font-size-m" onclick="history.back()">이전 단계로 이동</a>
            <a href="javascript:checkForm();" class="btn bg-yellow float-right w-50 rounded-0 py-lg-4 py-3 font-size-m">등록 완료</a>
        </div>
    </main>
    <footer include-html="/include/footer.html"></footer>

    <script src="/js/naver_login.js"></script>
    <script src="/js/login.js"></script>

    <script>includeHTML({});</script>
    <script>login_header();</script>

    <script type="text/javascript">
        function onLogout() {
            sessionStorage.clear();
            location.href = "index.html";
        }
    </script>

<script>
        
        var urlParam = function(name){
        var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
        if (results==null){
            return null;
        }
        else{
            return results[1] || 0;
        }
    }

    var getCookie = function(name) {
        var value = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
        return value? value[2] : null;
    };

    var setCookie = function(name, value, day) {
        var date = new Date();
        date.setTime(date.getTime() + day * 60 * 60 * 24 * 1000);
        document.cookie = name + '=' + value + ';expires=' + date.toUTCString() + ';path=/';
    };


    function checkForm(){
        var category1 = $(":input:radio[name=category1]:checked").val();
        var numberUpDown = $('#numberUpDown').val();
        var category2 = $(":input:radio[name=category2]:checked").val();
        var numberUpDown2 = $('#numberUpDown2').val();
        var arr_times = document.getElementsByName("times");
        var arr_times2 = document.getElementsByName("times2");
        var timesText = [];
        var times2Text = [];

        for(var i=0;i<arr_times.length;i++){
            timesText.push(arr_times[i].textContent);
        }

        for(var i=0;i<arr_times2.length;i++){
            times2Text.push(arr_times2[i].textContent);
        }
        var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === xhr.DONE) {
                    if (xhr.status === 200 || xhr.status === 201) {
                        window.location.href = "/host/class_list.html";
                    } else {
                        alert("등록이 정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
                        console.error(xhr.responseText);
                    }
                }else{
                }
            };
            xhr.open('POST', 'http://3.34.150.116:3000/class/modify/price',true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.send("key="+getCookie("s3_id")+"&category1="+category1+"&numberUpDown="+numberUpDown+"&category2="+category2
            +"&numberUpDown2="+numberUpDown2+"&times="+timesText.toString()+"&times2="+times2Text.toString()); 
   
    }
    $(document).ready(function (){
        var s_key = urlParam("key");
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState === xhr.DONE) { 
                if (xhr.status === 200 || xhr.status === 201) {
                    var result = JSON.parse(xhr.responseText);
                    $("input[name=category1][value="+result[0].class_type+"]").prop("checked",true);
                    $("#numberUpDown").val(result[0].class_people);
                    $("input[name=category2][value="+result[0].class_type_two+"]").prop("checked",true);
                    $("#numberUpDown2").val(result[0].class_people_two);
                    setCookie("s3_id",s_key,1);
                    var arrDay = result[0].class_price.split(',');
                    for (var nArrCnt in arrDay) {
                       
                            var tag_temp = '<div class="tag mt-3">'
                                                +'<span class="mr-lg-2" name="times" value='+arrDay[nArrCnt]+'>'+arrDay[nArrCnt]+'</span>'
                                                +'<button type="button" class="btn bg-transparent" onclick="removeTag(this)"><i class="fa fa-times text-red"></i></button>'
                                            +'</div>';
                            
                            $("#clock").append(tag_temp);  
                        
                    }  
                    var arrDay2 = result[0].class_price_two.split(',');
                    for (var nArrCnt in arrDay2) {
                        
                            var tag_temp = '<div class="tag mt-3">'
                                                +'<span class="mr-lg-2" name="times2" value='+arrDay2[nArrCnt]+'>'+arrDay2[nArrCnt]+'</span>'
                                                +'<button type="button" class="btn bg-transparent" onclick="removeTag(this)"><i class="fa fa-times text-red"></i></button>'
                                            +'</div>'; 
                            $("#clock2").append(tag_temp);  
                        
                    }
                } else {
                    alert("정보를 불러오던 중 오류가 발생했습니다. 다시 시도해주세요.");
                    console.error(xhr.responseText);
                }
            }else{
                
            }
        };
        xhr.open('POST', 'http://3.34.150.116:3000/class/price',true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.send("studio_key="+s_key);
    });


    function addTime2() {
        let start = $('#lesson_start').val();
        let price = $('#lesson_price').val();

        if (!start) {
            alert('태그를 입력하세요.');
            $('#lesson_start').focus();
            return;
        }
        if (!price) {
            alert('태그를 입력하세요.');
            $('#lesson_price').focus();
            return;
        }

        var tag_temp = '<div class="tag mt-3">'
                            +'<span class="mr-lg-2" name="times" value="'+start+' '+price+'원">'+start+' '+price+'원</span>'
                            +'<button type="button" class="btn bg-transparent" onclick="removeTag(this)"><i class="fa fa-times text-red"></i></button>'
                        +'</div>';
        
        $("#clock").append(tag_temp);  
    }

    function addTime3() {
        let start = $('#lesson_start2').val();
        let price = $('#lesson_price2').val();

        if (!start) {
            alert('태그를 입력하세요.');
            $('#lesson_start2').focus();
            return;
        }
        if (!price) {
            alert('태그를 입력하세요.');
            $('#lesson_price2').focus();
            return;
        }

        var tag_temp = '<div class="tag mt-3">'
                            +'<span class="mr-lg-2" name="times2" value="'+start+' '+price+'원">'+start+' '+price+'원</span>'
                            +'<button type="button" class="btn bg-transparent" onclick="removeTag(this)"><i class="fa fa-times text-red"></i></button>'
                        +'</div>';
        
        $("#clock2").append(tag_temp);  
    }

     // number of people
     $('#decreaseQuantity').click(function (e) {
        e.preventDefault();
        var stat = $('#numberUpDown').val();
        var num = parseInt(stat, 10);
        num--;

        if (num <= 0) {
            num = 1;
        }
        $('#numberUpDown').val(num);
    });
    
    $('#increaseQuantity').click(function (e) {
        e.preventDefault();
        var stat = $('#numberUpDown').val();
        var num = parseInt(stat, 10);
        num++;

        if (num > 100) {
            num = 100;
        }
        $('#numberUpDown').val(num);
    });
   
    $('#decreaseQuantity2').click(function (e) {
        e.preventDefault();
        var stat = $('#numberUpDown2').val();
        var num = parseInt(stat, 10);
        num--;

        if (num <= 0) {
            num = 1;
        }
        $('#numberUpDown2').val(num);
    });
    
    $('#increaseQuantity2').click(function (e) {
        e.preventDefault();
        var stat = $('#numberUpDown2').val();
        var num = parseInt(stat, 10);
        num++;

        if (num > 100) {
            num = 100;
        }
        $('#numberUpDown2').val(num);
    });
    $(function () {
        // file upload
        var fileTarget = $('.custom-inputs-sub.not .upload-hidden');
        fileTarget.on('change', function() {
            // 값이 변경되면
            if(window.FileReader){ // modern browser
                var filename = $(this)[0].files[0].name;
            } else { // old IE
                var filename = $(this).val().split('/').pop().split('\\').pop(); // 파일명만 추출
            }
            // 추출한 파일명 삽입
            $(this).siblings('.upload-name').val(filename);
        });
    })
</script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <!-- Datepicker : 날짜 선택 기능이 있는 페이지에서만 사용 -->
    <script src="/js/datepicker.js"></script>
    <script src="/js/include_html_host.js"></script>
    <!-- <script src="/js/custom.js"></script> -->
</body>


</html>