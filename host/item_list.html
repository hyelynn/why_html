<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html">
    <title>ART BY US</title>

    <!-- Bootstrap 4.3.1 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/custom.css">
    <link rel="stylesheet" href="/css/custom_host.css">
    <link rel="stylesheet" href="/css/fontawesome/css/all.min.css">

    <!-- Custom -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="/js/include.js"></script>
    <!-- Custom -->

    <script type="text/javascript" src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.0.js"
        charset="utf-8"></script>
    <script src="/js/kakao_sdk.js"></script>

    <script>
        Kakao.init('d88bea310f4a39afbea3146fe1c0fa72');
        Kakao.isInitialized();
    </script>

    <script src="js/custom.js"></script>

    <!-- Fontawesome -->
    <link rel="stylesheet" href="css/fontawesome/css/all.min.css">
</head>

<body>
 <!-- 모달 -->
 <div id="modals"></div>

 <!-- 서브 헤더 -->
 <!-- <header id="header"></header> -->
    <!-- 헤더부분 네비게이션 바-->
    <nav class="navbar navbar-expand-lg navbar-light py-lg-3 py-1">
        <div class="container">
            <!--네비게이션 바 버튼-->
            <a class="navbar-brand" href="/host/index.html"><img src="http://artbyus.co.kr/img/us-partner-logo.png"
                srcset="http://artbyus.co.kr/img/us-partner-logo@2x.png 2x, http://artbyus.co.kr/img/us-partner-logo@3x.png 3x"></a>
            
            <button class="navbar-toggler border-0 font-size-md text-dark" type="button" data-toggle="collapse"
                data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false"
                aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>

            <div class="collapse navbar-collapse" id="navbarNavDropdown"></div>
        </div>
    </nav>
    <script src="/js/header.js"></script>


    <main role="main">
        <div class="container my-md-5 my-4">
            <div class="d-flex justify-content-between align-items-center host-top-function mb-md-5 mb-4">
                <h2 class="">등록/관리</h2>
                <a href="javascript:addStu();" class="btn d-flex align-items-center rounded-pill bg-dark text-white font-weight-light px-lg-4 px-2 font-size-xs btn-sm">추가하기</a>
            </div>

            <!-- 카테고리 -->
            <div class="d-flex custom-nav-tabs text font-size-m mb-md-5 mb-4">
                <a href="studio_list.html" class="mr-md-5 mr-4 position-relative tab-title">스튜디오</a>
                <a href="class_list.html" class="mr-md-5 mr-4 position-relative tab-title">클래스</a>
                <a href="performance_list.html" class="mr-md-5 mr-4 position-relative tab-title">퍼포먼스</a>
                <a href="audition_list.html" class="mr-md-5 mr-4 position-relative tab-title">오디션</a>
                <a href="store_list.html" class="position-relative tab-title">스토어</a>
            </div>

            <!-- 등록된 아이템 리스트 -->
            <div class="row" id="std_list">
                
            </div>
        </div>
    </main>

    <!-- 서브 푸터 -->
    <footer include-html="/include/footer.html"></footer>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <footer include-html="/include/footer.html"></footer>

    <script src="/js/naver_login.js"></script>
    <script src="/js/login.js"></script>

    <script src="/js/include_html_host.js"></script>

    <script>includeHTML({});</script>
    <script>login_header();</script>

    <script type="text/javascript">
        var studio_list = [];

        function onLogout() {
            sessionStorage.clear();
            location.href = "index.html";
        }

        function modStu(key,cate){
            if(sessionStorage.getItem("id")!= null){
             window.location.href = "/host/item_register.html?key="+key+"&category="+cate;
            }else{
                alert("로그인해주세요.");
                window.location.href = "/index.html";
            }
        }

        function delStu(key){
            if(sessionStorage.getItem("id")!= null){
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === xhr.DONE) { 
                        if (xhr.status === 200 || xhr.status === 201) {
                            redirect();
                        } else {
                            alert("삭제가 정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
                            console.error(xhr.responseText);
                        }
                    }else{}
                };
                xhr.open('POST', 'http://3.34.150.116:3000/studio/delete',true);
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                xhr.send("key="+key);
            }else{
                alert("로그인해주세요.");
                window.location.href = "/index.html";
            }
        }

        function addStu(){
            if(sessionStorage.getItem("id")!= null){
                window.location.href = "/host/item_register.html?category=studio";
            }else{
                alert("로그인해주세요.");
                window.location.href = "/index.html";
            }
        }
        
        $(document).ready(function (){
            redirect();
        });

        function redirect(){
            studio_list = [];
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === xhr.DONE) { 
                    if (xhr.status === 200 || xhr.status === 201) {
                        studio_list = JSON.parse(xhr.responseText);
                        writeList(studio_list);
                    } else {
                        alert("목록이 정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
                        console.error(xhr.responseText);
                    }
                }else{
                }
            };
            xhr.open('POST', 'http://3.34.150.116:3000/studio/host',true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            // xhr.send("user_id=jmnu1203");
            xhr.send("user_id="+sessionStorage.getItem("id"));
        }

        function writeList(list){
            $("#std_list").empty();
            for(var i = 0; i<list.length;i++){
                var studio = '<div id="studio_li_'+list[i].obj_key+'" class="col-lg-3 col-6 mb-lg-5 mb-4">'
                                +'<div class="card border-0 bg-transparent mb-2">'
                                    +'<div class="position-absolute p-md-2 p-1 w-100 z-index-2">'
                                        +'<div class="p-lg-2 p-1 d-flex list-tag list-tag-yellow">'
                                            +'<span class="align-self-center list-tag-title">'+list[i].obj_types+ '</span>'
                                        +'</div>'
                                        +'<div class="float-right bg-white px-2 rounded-xl font-size-xs">'
                                            +'<i class="fas fa-heart text-red"></i> <span>'+list[i].obj_like+'</span>'
                                        +'</div>'
                                    +'</div>'
                                    +'<img src="'+list[i].obj_thumbnail+'" class="card-img-top rounded-0" srcset="'+list[i].obj_thumbnail+' 2x, '+list[i].obj_thumbnail+' 3x" alt="">'
                                    +'<h5 class="mt-lg-3 mt-2">'+list[i].obj_name+'</h5>'
                                    +'<p class="font-weight-light border-bottom pb-2 mb-2 font-size-xs">'+list[i].obj_subname+'</p>'
                                    +'<a href="#x" class="stretched-link text-decoration-none">'
                                        +'<span class="text-red font-weight-bold font-size-l">'+list[i].obj_price+'</span>'
                                        +'<span class="text-dark font-weight-light pl-1 font-size-s">원/시간</span>'
                                    +'</a>'
                                +'</div>'
                                +'<div class="d-flex host-item-btn">'
                                    +'<button class="btn flex-fill bg-sky text-white" onclick="modStu('+list[i].obj_key+');">수정</button>'
                                    +'<button class="btn flex-fill bg-gray" onclick="delStu('+list[i].obj_key+');">삭제</button>'
                                +'</div>'
                            +'</div>';
                $("#std_list").append(studio);

                if(i % 4 == 3){
                    var line = '<div class="w-100"></div>'
                    $("#std_list").append(line);
                }
            }
        }
        
    </script>
</body>

</html>