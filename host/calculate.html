<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ART BY US</title>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

    <!-- Bootstrap 4.3.1 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- Custom -->
    <link rel="stylesheet" href="/css/custom.css">
    <link rel="stylesheet" href="/css/custom_host.css">

    <!-- Fontawesome -->
    <link rel="stylesheet" href="/css/fontawesome/css/all.min.css">

    <script src="/js/include.js"></script>
    <!-- Custom -->

    <script type="text/javascript" src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.0.js"
        charset="utf-8"></script>
    <script src="/js/kakao_sdk.js"></script>

    <script>
        Kakao.init('d88bea310f4a39afbea3146fe1c0fa72');
        Kakao.isInitialized();
    </script>
</head>

<body>
    <modal include-html="/include/header.html"></modal>
    <div class="py-md-3 px-5 py-2 text-center text-white bg-deep-dark top-notice">
        <span class="font-weight-light">코로나19에 대한 아트바이어스의 대책 및 환불 정책에 대한 최신 정보를 확인하세요.</span>
        <a href="#x" class="text-white d-lg-inline-block d-block">자세히 알아보기</a>
    </div>

    <nav class="navbar navbar-expand-lg navbar-light py-lg-3 py-1">
        <div class="container">
            <a class="navbar-brand" href="/index.html"><img src="http://artbyus.co.kr/img/logo.png"
                    srcset="http://artbyus.co.kr/img/logo@2x.png 2x, http://artbyus.co.kr/img/logo@3x.png 3x"></a>
            
            <button class="navbar-toggler border-0 font-size-md text-dark" type="button" data-toggle="collapse"
                data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false"
                aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>

            <div class="collapse navbar-collapse" id="navbarNavDropdown"></div>
        </div>
    </nav>
    <script src="/js/header.js"></script>
    
    <main role="main">
        <div id="carouselAdContent" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="/img/main_carousel_lg.jpg"
                        srcset="/img/main_carousel_lg@2x.jpg 2x, /img/main_carousel_lg@3x.jpg 3x"
                        class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                    <img src="/img/main_carousel_lg.jpg"
                        srcset="/img/main_carousel_lg@2x.jpg 2x, /img/main_carousel_lg@3x.jpg 3x"
                        class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                    <img src="/img/main_carousel_lg.jpg"
                        srcset="/img/main_carousel_lg@2x.jpg 2x, /img/main_carousel_lg@3x.jpg 3x"
                        class="d-block w-100" alt="...">
                </div>
            </div>

            <a class="carousel-control-prev" href="#carouselAdContent" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselAdContent" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>

        <!-- 정산 요약 -->
        <div class="text-center mb-lg-5 mb-3 bg-yellow">
            <div class="container py-lg-5 py-4">
                <div class="host-summary-board">
                    <div class="row" id="pri_text">
                        
                    </div>
                </div>
            </div>
        </div>

        <!-- 리스트 -->
        <div class="container">
            <!-- 검색 및 정렬 -->
            <div class="d-lg-flex mb-3 custom-inputs-sub host-top-function">
                <div class="input-group search-bar-solid">
                    <input type="text" id="searchTxt" class="form-control text-dark search-text" placeholder="공간명을 검색해주세요"
                        aria-label="공간명을 검색해주세요" aria-describedby="search-studio">
                    <div class="input-group-append">
                        <button type="button" onclick="searchBtn();" class="btn bg-yellow text-gray">검색</button>
                    </div>
                </div>

                <div class="d-flex mt-3 mt-lg-0">
                    <a href="#" class="d-flex align-items-center justify-content-center btn font-weight-light bg-yellow mx-lg-3 mr-3 text-btn">
                        <span>계좌정보 수정</span>
                    </a>
                    <select id="select_sort" class="form-control font-weight-light">
                        <option value="1">가나다순</option>
                        <option value="2">최신순</option>
                        <option value="3">오름차순</option>
                        <option value="4">내림차순</option>
                    </select>
                </div>
            </div>

            <!-- 리스트 -->
            <ul id="calList" class="list-group host-item-list calc">
                
                
            </ul>
        </div>
    </main>

    <footer include-html="/include/footer.html"></footer>

    <script src="/js/naver_login.js"></script>
    <script src="/js/login.js"></script>

    <script>includeHTML({});</script>
    <script>login_header();</script>

    <script type="text/javascript">
        function onLogout() {
            sessionStorage.clear();
            location.href = "index.html";
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

    <script src="/js/custom.js"></script>

    <script>
        var studio_list = [];
        var search_list = [];
        
        function searchBtn(){
            search_list = [];
            for(var i = 0;i<studio_list.length;i++){
                if(studio_list[i].obj_name.indexOf($("#searchTxt").val()) != -1){
                    search_list.push(studio_list[i]);
                }
            }
            writeList(search_list);
        }

        $("#select_sort").change(function (){
            switch(this.value){
                case "1":{//가나다
                    studio_list.sort(function(a,b){
                        return a.obj_name > b.obj_name ? -1 : a.obj_name > b.obj_name ? 1 : 0;
                    });
                    break;
                }case "2":{//최신순
                    studio_list.sort(function(a,b){
                        return a.obj_key < b.obj_key ? -1 : a.obj_key > b.obj_key ? 1 : 0;
                    });
                    break;
                }case "3":{//오름차순
                    studio_list.sort(function(a,b){
                        return a.obj_name < b.obj_name ? -1 : a.obj_name > b.obj_name ? 1 : 0;
                    });
                    break;
                }case "4":{//내림차순
                    studio_list.sort(function(a,b){
                        return a.obj_name > b.obj_name ? -1 : a.obj_name > b.obj_name ? 1 : 0;
                    });
                    break;
                }
            }
            writeList(studio_list);
        });
        
        function writeList(list){
            $("#calList").empty();
            for(var i = 0; i<list.length;i++){
                var price = '<li class="list-group-item p-3 mb-3 border">'
                                +'<div class="row align-items-center">'
                                    +'<div class="col-lg-9">'
                                        +'<div class="d-flex align-items-lg-center">'
                                            +'<div class="d-flex justify-content-center overflow-hidden mr-4 item-thumbs">'
                                                +'<img src="'+list[i].obj_thumbnail+'" class="align-self-center h-100" alt="">'
                                                +'</div>'
                                                +'<div class="item-texts">'
                                                    +'<a href="/sub/studio_view.html" class="text-decoration-none">'
                                                        +'<h4 class="text-gray">'+list[i].obj_name
                                                            +'<p class="font-size-xs ml-lg-3 ml-2 d-inline-block mb-1 align-middle">'
                                                                +'<i class="fas fa-heart text-red"></i> <span class="ml-1">'+list[i].obj_like+'</span>'
                                                            +'</p>'
                                                        +'</h4>'
                                                    +'</a>'
                                                    +'<p class="font-weight-light text-light-gray mb-2">'+list[i].obj_subname+'</p>'
                                                    +'<p class="font-weight-light mb-0"><span class="mr-md-4">예약유형 : '+list[i].obj_types+'</span>'
                                                        +'<span class="d-md-inline-block d-block">'+list[i].obj_price+'원 / 시간</span>'
                                                    +'</p>'
                                                +'</div>'
                                            +'</div>'
                                        +'</div>'
                                        +'<div class="col-lg-3">'
                                            +'<div class="text-lg-center text-right mt-lg-0 mt-3 calc-number">'
                                                +'<span class="font-weight-light">최종 정산 금액</span>'
                                                +'<p class="mb-0 large-number">'+list[i].tot_price+'</p>'
                                            +'</div>'
                                        +'</div>'
                                    +'</div>'
                            +'</li>';
                $("#calList").append(price);
            }
        }

        $(document).ready(function (){
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === xhr.DONE) { 
                    if (xhr.status === 200 || xhr.status === 201) {
                        var result = JSON.parse(xhr.responseText);
                        var price = '<div class="col-md-4 col-6">'
                                        +'<span class="font-weight-light">이번 달 정산 금액</span>'
                                        +'<p class="mb-0 large-number">'+result[0].this_price+'원</p>'
                                    +'</div>'
                                    +'<div class="col-md-4 col-6">'
                                        +'<span class="font-weight-light">입금 예정 금액</span>'
                                        +'<p class="mb-0 large-number">'+result[0].will_price+'원</p>'
                                    +'</div>'
                                    +'<div class="col-md-4 col-12 mt-4 mt-md-0">'
                                        +'<span class="font-weight-light">누적 정산 금액</span>'
                                        +'<p class="mb-0 large-number">'+result[0].add_price+'원</p>'
                                    +'</div>';
                        $("#pri_text").append(price);
                    } else {
                        alert("등록이 정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
                        console.error(xhr.responseText);
                    }
                }else{
                    
                }
            };
            xhr.open('POST', 'http://3.34.150.116:3000/price/result',true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            // xhr.send("key=jmnu1203");
            xhr.send("key="+sessionStorage.getItem("id"));
        
            var xhr2 = new XMLHttpRequest();
            xhr2.onreadystatechange = function() {
                if (xhr2.readyState === xhr2.DONE) { 
                    if (xhr2.status === 200 || xhr2.status === 201) {
                        studio_list = JSON.parse(xhr2.responseText);
                        writeList(studio_list);
                    } else {
                        alert("등록이 정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
                        console.error(xhr2.responseText);
                    }
                }else{
                    
                }
            };
            xhr2.open('POST', 'http://3.34.150.116:3000/price/object',true);
            xhr2.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            // xhr2.send("key=jmnu1203");
            xhr.send("key="+sessionStorage.getItem("id"));
        });

        // 수정 input 활성화
        function handleQna(id) {
            console.log(id)
            let answer_text = $.trim($('#' + id).find('p.answer').text());

            // console.log($('#' + id))
            $('#' + id).find('div.card-body').hide();
            $('#' + id).find('div.accordion-textarea').show().find('textarea').val(answer_text).focus();
        }

        // 아코디언 collapse
        $('.host-accordion').on('show.bs.collapse', function () {
            $(this).find('i').attr('class', 'fas fa-angle-double-up')
        })
        $('.host-accordion').on('hide.bs.collapse', function () {
            $(this).find('i').attr('class', 'fas fa-angle-double-down')
        })
    </script>
</body>

</html>