<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ART BY US</title>

    <!-- Bootstrap 4.3.1 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"></script>
    <!-- Custom -->
    <link rel="stylesheet" href="/why_html/css/custom.css">
    <script src="/why_html/js/custom.js"></script>
    <script src="/why_html/js/upload.js"></script>
    <script src="/why_html/js/include.js"></script>
    <!-- Fontawesome -->
    <link rel="stylesheet" href="/why_html/css/fontawesome/css/all.min.css">

    <!-- Custom -->
    <script type="text/javascript" src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.0.js" charset="utf-8"></script>
    <script src="/why_html/js/kakao_sdk.js"></script>

     <script>
         // SDK를 초기화 합니다. 사용할 앱의 JavaScript 키를 설정해 주세요.
         Kakao.init('d88bea310f4a39afbea3146fe1c0fa72');
         // SDK 초기화 여부를 판단합니다.
         console.log(Kakao.isInitialized());
     </script>
 
</head>

<body>
    <header include-html="../include/header.html"></header>

    <!-- Terms Modal -->
    <div class="modal fade custom-modal-full" id="termsModal" tabindex="-1" role="dialog" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <div class="modal-content">
                <div class="modal-body">
                    test
                </div>
            </div>
        </div>
    </div>

    <main role="main">
        <div class="container py-lg-5 py-4">
            <div include-html="/why_html/main-signup/signup_userform.html"></div>
            <div include-html="/why_html/main-signup/signup_hostform.html"></div>
            


            <!-- checkbox -->
            <div class="d-flex mb-4 custom-inputs">
                <input type="checkbox" class="custom-checkbox mr-2" id="all_agree">
                <label for="all_agree" class="mb-0">
                    사업자 회원 약관 및 개인정보이용방안을 이해하였으며 이에 동의합니다.
                    <a href="../sub/terms.html#terms_host" class="text-dark" target="_blank">(보기)</a>
                </label>
            </div>

            <!-- button -->
            <div class="custom-inputs-sub not">
                <button type="button" id="send" onClick="sendFormAjax();" class="btn btn-block bg-yellow">사업자 회원가입 신청하기</button>
            </div>
        </div>
    </main>

    
    <footer include-html="../include/footer.html"></footer>
    <script>includeHTML();</script>
    <script src="/why_html/js/kakao_login.js"></script>
    <script src="/why_html/js/naver_login.js"></script>

<script type="text/javascript">
    var emailFlag = false;
    var albumBucketName = 'biz-cetificate';
    var bucketRegion = 'ap-northeast-2';
    var IdentityPoolId = 'ap-northeast-2:5de34811-ed49-42bb-8378-726186756855';

    AWS.config.update({
        region: bucketRegion,
        credentials: new AWS.CognitoIdentityCredentials({
            IdentityPoolId: IdentityPoolId
        })
    });

    var s3 = new AWS.S3({
        apiVersion: '2006-03-01',
        params: {Bucket: albumBucketName}
    });

    function addFile(albumName) {
        var files = document.getElementById('host_file').files;
        if (!files.length) {
            return alert('업로드할 파일을 선택해주세요.');
        }
        var file = files[0];
        var fileName = file.name;
        document.getElementById('file_name').value = fileName;
        // fileName = document.getElementById('host_id').value;
        var photoKey = fileName;
        s3.upload({
            Key: photoKey,
            Body: file,
            ACL: 'public-read'
        }, function(err, data) {
            if (err) {
                return alert('파일 업로드 실패: ', err, data);
                console.log(err, data);
            }
            alert('파일 업로드 성공');
            viewAlbum(albumName);
        });
    }

    
    document.getElementById("host_id").addEventListener('input', function(){
        emailFlag = false;
        document.getElementById("is_dup").disabled = false;
    });

    document.getElementById("is_dup").addEventListener('click', function(){
        var email =  document.getElementById("host_id").value;
        var regEmail = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/i;
        if (!regEmail.test(email)) {
            alert('아이디가 형식에 맞지 않습니다'); 
            document.getElementById("host_id").focus();
            return false;
        }
        var xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function() { 
            if (xhr.readyState === xhr.DONE) { 
                if (xhr.status === 200 || xhr.status === 201) {
                    var result = JSON.parse(xhr.responseText);
                    if(result.result=="false"){
                        alert("이미 사용중인 아이디 입니다.");
                        document.getElementById("host_id").value = "";
                        document.getElementById("host_id").focus();
                    }
                    else{
                        alert("사용 할 수 있는 아이디 입니다.");
                        emailFlag = true;
                        document.getElementById("is_dup").disabled = true;
                    }
                } else {
                }
            }
            else{
            }
        };
        
        xhr.open('POST', 'http://3.34.150.116:3000/user/verify');
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.send("email="+ email); 
    })
    
    function sendFormAjax(){
        if(CheckForm()){
        var host_id = document.getElementById("host_id").value;
        var host_pw = document.getElementById("host_pw").value;
        var host_name = document.getElementById("host_name").value;
        var host_nickname = document.getElementById("host_nickname").value;
        var host_phone = document.getElementById("host_phone").value;
        var host_type_sel = document.getElementById("host_type");
        var host_type = host_type_sel.options[host_type_sel.selectedIndex].value;
        var host_co_name = document.getElementById("host_co_name").value;
        var host_safe_no = document.getElementById("host_safe_no").value;
        var host_no = document.getElementById("host_no").value;
        var host_ceo = document.getElementById("host_ceo").value;
        var host_address = document.getElementById("host_address").value + " , " + document.getElementById("host_address2").value + " , " + document.getElementById("host_zipcode").value;
        var host_sector = document.getElementById("host_sector").value;
        var host_sector2 = document.getElementById("host_sector2").value;
        var host_bank_sel = document.getElementById("host_bank");
        var host_bank = host_bank_sel.options[host_bank_sel.selectedIndex].value;
        var host_bank_account = document.getElementById("host_bank_account").value;
        var host_bank_no = document.getElementById("host_bank_no").value;
        var files = document.getElementById('host_file').files;
        var host_file = files[0].name;
       
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState === xhr.DONE) { 
                if (xhr.status === 200 || xhr.status === 201) {
                    window.location.href = "../index.html";
                } else {
                    alert("회원가입이 정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
                    console.error(xhr.responseText);
                }
            }else{
            }
        };
        xhr.open('POST', 'http://3.34.150.116:3000/host/apply');
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.send("host_id="+host_id+"&host_pw="+host_pw+"&host_name="+host_name+"&host_nickname="+host_nickname+"&host_phone="+host_phone+"&host_safe_no="+host_safe_no
        +"&host_type="+host_type+"&host_co_name="+host_co_name+"&host_no="+host_no+"&host_ceo="+host_ceo+"&host_address="+host_address+"&host_sector="+host_sector
        +"&host_sector2="+host_sector2+"&host_bank="+host_bank+"&host_bank_account="+host_bank_account+"&host_bank_no="+host_bank_no+"&host_file="+host_file); 
    }
}
    function CheckForm(){
        var host_id = document.getElementById("host_id").value;
        var host_pw = document.getElementById("host_pw").value;
        var host_pw2 = document.getElementById("host_pw2").value;
        var host_name = document.getElementById("host_name").value;
        var host_nickname = document.getElementById("host_nickname").value;
        var host_phone = document.getElementById("host_phone").value;
        var host_auth = document.getElementById("host_auth").value;
        var host_safe_no = document.getElementById("host_safe_no").value;
        var host_type = document.getElementById("host_type");
        var host_co_name = document.getElementById("host_co_name").value;
        var host_no = document.getElementById("host_no").value;
        var host_ceo = document.getElementById("host_ceo").value;
        var host_zipcode = document.getElementById("host_zipcode").value;
        var host_address = document.getElementById("host_address").value;
        var host_address2 = document.getElementById("host_address2").value;
        var host_sector = document.getElementById("host_sector").value;
        var host_sector2 = document.getElementById("host_sector2").value;
        var host_bank = document.getElementById("host_bank");
        var host_bank_account = document.getElementById("host_bank_account").value;
        var host_bank_no = document.getElementById("host_bank_no").value;
        var host_file = document.getElementById("host_file").value;
        var all_agree = document.getElementById("all_agree");
        var regPw = /^[A-Za-z0-9+]*$/;
        var regPhone = /^\d{2,3}-\d{3,4}-\d{4}$/;

        if(host_id == ""){
            alert("아이디를 입력해주세요.");
            document.getElementById("host_id").focus();
            return false;
        }
        if(!emailFlag){
            alert("아이디를 인증해주세요");
            return false;
        }
        if(host_pw == ""){
            alert("비밀번호를 입력해주세요.");
            document.getElementById("host_pw").focus();
            return false;
        }
        if(host_pw.length < 6 || host_pw.length > 14){
            alert("비밀번호는 6~14자리 입력해주세요.");
            document.getElementById("host_pw").focus();
            return false;
        }
        if (!regPw.test(document.getElementById('host_pw').value)) {
            alert('비밀번호가 형식에 맞지 않습니다'); 
            document.getElementById("host_pw").focus();
             return false;
        }
        if(host_pw2 == ""){
            alert("비밀번호 확인을 입력해주세요.");
            document.getElementById("host_pw2").focus();
            return false;
        }
        if(host_pw != host_pw2){
            alert("비밀번호가 서로 일치하지 않습니다.");
            document.getElementById("host_pw2").focus();
            return false;
        }
        if(host_name == ""){
            alert("이름을 입력해주세요.");
            document.getElementById("host_name").focus();
            return false;
        }
        if(host_nickname == ""){
            alert("닉네임을 입력해주세요.");
            document.getElementById("host_nickname").focus();
            return false;
        }
        if(host_phone == ""){
            alert("연락처를 입력해주세요.");
            document.getElementById("host_phone").focus();
            return false;
        }
        if (!regPhone.test(document.getElementById('host_phone').value)) {
             alert('전화번호가 형식에 맞지 않습니다'); 
            document.getElementById("host_phone").focus();
             return false;
        }
        if(host_auth == ""){
            alert("인증번호를 입력해주세요.");
            document.getElementById("host_auth").focus();
            return false;
        }
        if(host_auth != 1234){
            alert("인증번호가 맞지 않습니다.");
            document.getElementById("host_auth").focus();
            return false;
        }
        if(host_safe_no == ""){
            alert("안심번호를 입력해주세요.");
            document.getElementById("host_safe_no").focus();
            return false;
        }
        if(host_type.options[host_type.selectedIndex].text == ""){
            alert("사업자 유형을 선택해주세요.");
            document.getElementById("host_type").focus();
            return false;
        }
        if(host_co_name == ""){
            alert("상호명을 입력해주세요.");
            document.getElementById("host_co_name").focus();
            return false;
        }
        if(host_no == ""){
            alert("사업자 등록번호를 입력해주세요.");
            document.getElementById("host_no").focus();
            return false;
        }
        if(host_ceo == ""){
            alert("대표자명을 입력해주세요.");
            document.getElementById("host_ceo").focus();
            return false;
        }
        if(host_zipcode == ""){
            alert("사업장 주소(우편번호)를 입력해주세요.");
            document.getElementById("host_zipcode").focus();
            return false;
        }
        if(host_address == ""){
            alert("사업장 주소(기본주소)를 입력해주세요.");
            document.getElementById("host_address").focus();
            return false;
        }
        if(host_address2 == ""){
            alert("사업장 주소(상세주소)를 입력해주세요.");
            document.getElementById("host_address2").focus();
            return false;
        }
        if(host_sector == ""){
            alert("업종을 입력해주세요.");
            document.getElementById("host_sector").focus();
            return false;
        }
        if(host_sector2 == ""){
            alert("업태를 입력해주세요.");
            document.getElementById("host_sector2").focus();
            return false;
        }
        if(host_bank.options[host_bank.selectedIndex].text == ""){
            alert("계좌은행을 선택해주세요.");
            document.getElementById("host_bank").focus();
            return false;
        }
        if(host_bank_account == ""){
            alert("예금주를 입력해주세요.");
            document.getElementById("host_bank_account").focus();
            return false;
        }
        if(host_bank_no == ""){
            alert("계좌번호를 입력해주세요.");
            document.getElementById("host_bank_no").focus();
            return false;
        }
        if(host_file == ""){
            alert("사업자등록증 사본을 등록해주세요.");
            document.getElementById("host_file").focus();
            return false;
        }
        if(all_agree.checked){
            return true ;
        }else{
            alert("동의를 해주세요.");
            return false;
        }
    }
 
</script>
</body>
</html>